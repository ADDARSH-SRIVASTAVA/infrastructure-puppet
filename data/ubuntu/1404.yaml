---
classes: 
  - apt
  - base
  - dnsclient
  - orthrus
  - postfix::server
  - subversionclient
  - dovecot

base::basepackages:
  - apt-file
  - bash
  - ca-certificates
  - git
  - software-properties-common
  - zsh
  - dovecot-ldap


apt::sources:
 'asf_internal':
     location: 'https://pkgrepo.apache.org'
     release: 'trusty'
     repos: 'main'
     key: 'E8640030'
     key_server: 'pgp.mit.edu'
     include_deb: 'true'
     include_src: 'false'

apt::force:
 'orthrus':
  release: 'main'
  resquire: Apt::Source['asf_internal']

ldapclient::install::ubuntu::1404::tlscertpath:  '/etc/ldap/cacerts/ldap-client.pem'
ldapclient::install::ubuntu::1404::pamhostcheck: 'yes'

ldapclient::ldapclient_packages: 
    - ldap-auth-client
    - ldap-utils
    - libldap-2.4-2
    - libnss-ldap
    - libpam-ldap
    - libpam-modules
    - nslcd

ldapclient::ldapclient_remove_packages: 
    - nscd

postfix::server::myhostname:             "%{::fqdn}"
postfix::server::mydomain:               'apache.org'
postfix::server::mydestination:          "%{::fqdn}, localhost.%{::domain}, localhost, apache.org"
postfix::server::inet_interfaces:        'all'
postfix::server::message_size_limit:     '15360000'
postfix::server::relayhost:              '[mail.apache.org]:2025'
postfix::server::mail_name:              "ASF Mail Server at %{::fqdn}"
postfix::server::virtual_mailbox_domains:
  - 'proxy:mysql:/etc/postfix/mysql_virtual_domains_maps.cf'
postfix::server::virtual_alias_maps:     
  -  'proxy:mysql:/etc/postfix/mysql_virtual_alias_maps.cf'
  -  'proxy:mysql:/etc/postfix/mysql_virtual_alias_domain_maps.cf'
  -  'proxy:mysql:/etc/postfix/mysql_virtual_alias_domain_catchall_maps.cf'
postfix::server::virtual_transport:      'dovecot'
postfix::server::smtpd_sender_restrictions:
  -  'permit_mynetworks'
  -  'reject_unknown_sender_domain'
postfix::server::smtpd_recipient_restrictions:    
  -  'permit_sasl_authenticated'
  -  'permit_mynetworks'
  -  'reject_unauth_destination'
postfix::server::smtpd_tls_key_file:     '/etc/ssl/wildcard.apache.org.key'
postfix::server::smtpd_tls_cert_file:    '/etc/ssl/wildcard.apache.org.cert'
postfix::server::smtpd_sasl_auth:        'true'
postfix::server::sender_canonical_maps:  'regexp:/etc/postfix/sender_canonical'
postfix::server::ssl:                    'wildcard.example.com'
postfix::server::submission:             'true'

subversionclient::packages: 
    - subversion

subversionclient::svn_conf_config:  '/etc/subversion/config'
subversionclient::svn_conf_servers: '/etc/subversion/servers'

dovecot::auth_debug:        'true'
dovecot::auth_verbose:      'true'
dovecot::protocols:         'none'
dovecot::auth_mechanisms:   'plain login'
dovecot::ssl:               'true'
dovecot::ssl_cert:          '/etc/ssl/wildcard.apache.org.cert'
dovecot::ssl_key:           '/etc/ssl/wildcard.apache.org.key'

