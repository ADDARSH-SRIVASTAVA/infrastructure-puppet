# This is the config file for the apr (and apr-util) project.

# schedulers

c['schedulers'].append(AnyBranchScheduler(name="on-apr-commit",
                         branches=["apr/apr/trunk"],
                         treeStableTimer=2,
                         builderNames=["apr-trunk" , "apr-trunk-fbsd" , "apr-trunk-fedora"]))

c['schedulers'].append(AnyBranchScheduler(name="on-apr-branch-1.4-commit",
                         branches=["apr/apr/branches/1.4.x"],
                         treeStableTimer=2,
                         builderNames=["apr-branch-1.4" , "apr-branch-1.4-fbsd" , "apr-branch-1.4-fedora"]))

c['schedulers'].append(AnyBranchScheduler(name="on-apr-util-branch-1.3-commit",
                         branches=["apr/apr-util/branches/1.3.x"],
                         treeStableTimer=2,
                         builderNames=["apr-util-branch-1.3" , "apr-util-branch-1.3-fbsd" , "apr-util-branch-1.3-fedora"]))

c['schedulers'].append(AnyBranchScheduler(name="on-apr-util-branch-1.4-commit",
                         branches=["apr/apr-util/branches/1.4.x"],
                         treeStableTimer=2,
                         builderNames=["apr-util-branch-1.4" , "apr-util-branch-1.4-fbsd" , "apr-util-branch-1.4-fedora"]))

#builders ubuntu

f_apr_1 = factory.BuildFactory()
f_apr_1.addStep(SVN(repourl=Interpolate("https://svn.apache.org/repos/asf/%(src::branch:~apr/apr/trunk)s")))

f_apr_1.addStep(Compile(command=["./buildconf"],
                        haltOnFailure=True,
))
f_apr_1.addStep(Compile(command=["./configure" , "--prefix=/home/buildslave1/slave1/apr-trunk/build/build" , "--with-libxml2"],
                        haltOnFailure=True,
))
f_apr_1.addStep(Compile(command=["make"],
                        haltOnFailure=True,
))
f_apr_1.addStep(Compile(command=["make" , "check"],
                        haltOnFailure=True,
))
# we dont need the install step, but whatever, lets test it anyway...
f_apr_1.addStep(Compile(command=["make" , "install"],
                        haltOnFailure=True,
))
f_apr_1.addStep(ShellCommand(
                command=["cp" , "/home/buildslave1/slave1/apr-trunk/build/build/bin/apr-2-config" , "/home/buildslave1/slave1/apr-trunk/"],
                description=["Copy apr-config"],
                descriptionDone=["apr-2-config copied"],
                haltOnFailure=True,
))

b_apr_1 = {'name': "apr-trunk",
      'slavename': "orcus_ubuntu",
      'builddir': "apr-trunk",
      'factory': f_apr_1,
      'category': "apr-trunk",
      }

c['builders'].append(b_apr_1)

f_apr_2 = factory.BuildFactory()
f_apr_2.addStep(SVN(repourl=Interpolate("https://svn.apache.org/repos/asf/%(src::branch:~apr/apr/branches/1.4.x)s")))

f_apr_2.addStep(Compile(command=["./buildconf"],
                        haltOnFailure=True,
))
f_apr_2.addStep(Compile(command=["./configure" , "--prefix=/home/buildslave1/slave1/apr-branch-1.4/build/build"],
                        haltOnFailure=True,
))
f_apr_2.addStep(Compile(command=["make"],
                        haltOnFailure=True,
))
f_apr_2.addStep(Compile(command=["make" , "check"],
                        haltOnFailure=True,
))
f_apr_2.addStep(Compile(command=["make" , "install"],
                        haltOnFailure=True,
))
f_apr_2.addStep(ShellCommand(
                command=["cp" , "/home/buildslave1/slave1/apr-branch-1.4/build/build/bin/apr-1-config" , "/home/buildslave1/slave1/apr-branch-1.4/"],
                description=["Copy apr-1-config"],
                descriptionDone=["apr-1-config copied"],
                haltOnFailure=True,
))

b_apr_2 = {'name': "apr-branch-1.4",
      'slavename': "orcus_ubuntu",
      'builddir': "apr-branch-1.4",
      'factory': f_apr_2,
      'category': "apr-branch-1.4",
      }

c['builders'].append(b_apr_2)

f_apr_3 = factory.BuildFactory()
f_apr_3.addStep(SVN(repourl=Interpolate("https://svn.apache.org/repos/asf/%(src::branch:~apr/apr/branches/1.3.x)s")))

f_apr_3.addStep(Compile(command=["./buildconf" , "--with-apr=/home/buildslave1/slave1/apr-branch-1.4/build/"],
                        haltOnFailure=True,
))
f_apr_3.addStep(Compile(command=["./configure" , "--prefix=/home/buildslave1/slave1/apr-util-branch-1.3/build/build" ,
                                 "--with-apr=/home/buildslave1/slave1/apr-branch-1.4/apr-1-config"],
                        haltOnFailure=True,
))
f_apr_3.addStep(Compile(command=["make"],
                        haltOnFailure=True,
))
f_apr_3.addStep(Compile(command=["make" , "check"],
                        haltOnFailure=True,
))

b_apr_3 = {'name': "apr-util-branch-1.3",
      'slavename': "orcus_ubuntu",
      'builddir': "apr-util-branch-1.3",
      'factory': f_apr_3,
      'category': "apr-util-branch-1.3",
      }

c['builders'].append(b_apr_3)

f_apr_4 = factory.BuildFactory()
f_apr_4.addStep(SVN(repourl=Interpolate("https://svn.apache.org/repos/asf/%(src::branch:~apr/apr-util/branches/1.4.x)s")))

f_apr_4.addStep(Compile(command=["./buildconf" , "--with-apr=/home/buildslave1/slave1/apr-branch-1.4/build/"],
                        haltOnFailure=True,
))
f_apr_4.addStep(Compile(command=["./configure" , "--prefix=/home/buildslave1/slave1/apr-util-branch-1.4/build/build" , 
				 "--with-apr=/home/buildslave1/slave1/apr-branch-1.4/apr-1-config"],
			haltOnFailure=True,
))
f_apr_4.addStep(Compile(command=["make"],
			haltOnFailure=True,
))
f_apr_4.addStep(Compile(command=["make" , "check"],
			haltOnFailure=True,
))

b_apr_4 = {'name': "apr-util-branch-1.4",
      'slavename' : "orcus_ubuntu",
      'builddir': "apr-util-branch-1.4",
      'factory': f_apr_4,
      'category': "apr-util-branch-1.4",
      }

c['builders'].append(b_apr_4)

#builders fbsd

f_apr_5 = factory.BuildFactory()
f_apr_5.addStep(SVN(repourl=Interpolate("https://svn.apache.org/repos/asf/%(src::branch:~apr/apr/trunk)s")))

f_apr_5.addStep(Compile(command=["./buildconf"],
                        haltOnFailure=True,
))
f_apr_5.addStep(Compile(command=["./configure" , "--prefix=/home/buildslave27/slave27/apr-trunk-fbsd/build/build"],
                        haltOnFailure=True,
))
f_apr_5.addStep(Compile(command=["make"],
                        haltOnFailure=True,
))
f_apr_5.addStep(Compile(command=["make" , "check"],
                        haltOnFailure=True,
))
# we dont need the install step, but whatever, lets test it anyway...
f_apr_5.addStep(Compile(command=["make" , "install"],
                        haltOnFailure=True,
))
f_apr_5.addStep(ShellCommand(
                command=["cp" , "/home/buildslave27/slave27/apr-trunk-fbsd/build/build/bin/apr-2-config" , "/home/buildslave27/slave27/apr-trunk-fbsd/"],
                description=["Copy apr-2-config"],
                descriptionDone=["apr-2-config copied"],
                haltOnFailure=True,
))

b_apr_5 = {'name': "apr-trunk-fbsd",
      'slavename': "bb-fbsd2_64bit",
      'builddir': "apr-trunk-fbsd",
      'factory': f_apr_5,
      'category': "apr-trunk-fbsd",
      }

c['builders'].append(b_apr_5)

f_apr_6 = factory.BuildFactory()

f_apr_6.addStep(SVN(repourl=Interpolate("https://svn.apache.org/repos/asf/%(src::branch:~apr/apr/branches/1.4.x)s")))
f_apr_6.addStep(Compile(command=["./buildconf"],
                        haltOnFailure=True,
))
f_apr_6.addStep(Compile(command=["./configure" , "--prefix=/home/buildslave27/slave27/apr-branch-1.4-fbsd/build/build"],
                        haltOnFailure=True,
))
f_apr_6.addStep(Compile(command=["make"],
                        haltOnFailure=True,
))
f_apr_6.addStep(Compile(command=["make" , "check"],
                        haltOnFailure=True,
))
f_apr_6.addStep(Compile(command=["make" , "install"],
                        haltOnFailure=True,
))
f_apr_6.addStep(ShellCommand(
                command=["cp" , "/home/buildslave27/slave27/apr-branch-1.4-fbsd/build/build/bin/apr-1-config" , "/home/buildslave27/slave27/apr-branch-1.4-fbsd/"],
                description=["Copy apr-1-config"],
                descriptionDone=["apr-1-config copied"],
                haltOnFailure=True,
))

b_apr_6 = {'name': "apr-branch-1.4-fbsd",
      'slavename': "bb-fbsd2_64bit",
      'builddir': "apr-branch-1.4-fbsd",
      'factory': f_apr_6,
      'category': "apr-branch-1.4-fbsd",
      }

c['builders'].append(b_apr_6)

f_apr_7 = factory.BuildFactory()

f_apr_7.addStep(SVN(repourl=Interpolate("https://svn.apache.org/repos/asf/%(src::branch:~apr/apr-util/branches/1.3.x)s")))

f_apr_7.addStep(Compile(command=["./buildconf" , "--with-apr=/home/buildslave27/slave27/apr-branch-1.4-fbsd/build/"],
                        haltOnFailure=True,
))
f_apr_7.addStep(Compile(command=["./configure" , "--prefix=/home/buildslave27/slave27/apr-util-branch-1.3-fbsd/build/build" ,
                                 "--with-apr=/home/buildslave27/slave27/apr-branch-1.4-fbsd/apr-1-config"],
                        haltOnFailure=True,
))
f_apr_7.addStep(Compile(command=["make"],
                        haltOnFailure=True,
))
f_apr_7.addStep(Compile(command=["make" , "check"],
                        haltOnFailure=True,
))

b_apr_7 = {'name': "apr-util-branch-1.3-fbsd",
      'slavename': "bb-fbsd2_64bit",
      'builddir': "apr-util-branch-1.3-fbsd",
      'factory': f_apr_7,
      'category': "apr-util-branch-1.3-fbsd",
      }

c['builders'].append(b_apr_7)

f_apr_8 = factory.BuildFactory()

f_apr_8.addStep(SVN(repourl=Interpolate("https://svn.apache.org/repos/asf/%(src::branch:~apr/apr-util/branches/1.4.x)s")))

f_apr_8.addStep(Compile(command=["./buildconf" , "--with-apr=/home/buildslave27/slave27/apr-branch-1.4-fbsd/build/"],
                        haltOnFailure=True,
))
f_apr_8.addStep(Compile(command=["./configure" , "--prefix=/home/buildslave27/slave27/apr-util-branch-1.4-fbsd/build/build" , 
				 "--with-apr=/home/buildslave27/slave27/apr-branch-1.4-fbsd/apr-1-config"],
			haltOnFailure=True,
))
f_apr_8.addStep(Compile(command=["make"],
			haltOnFailure=True,
))
f_apr_8.addStep(Compile(command=["make" , "check"],
			haltOnFailure=True,
))

b_apr_8 = {'name': "apr-util-branch-1.4-fbsd",
      'slavename' : "bb-fbsd2_64bit",
      'builddir': "apr-util-branch-1.4-fbsd",
      'factory': f_apr_8,
      'category': "apr-util-branch-1.4-fbsd",
      }

c['builders'].append(b_apr_8)

# builders fedora


f_apr_9 = factory.BuildFactory()

f_apr_9.addStep(SVN(repourl=Interpolate("https://svn.apache.org/repos/asf/%(src::branch:~apr/apr/trunk)s")))

f_apr_9.addStep(Compile(command=["./buildconf"],
                        haltOnFailure=True,
))
f_apr_9.addStep(Compile(command=["./configure" , "--prefix=/home/buildslave13/slave13/apr-trunk-fedora/build/build"],
                        haltOnFailure=True,
))
f_apr_9.addStep(Compile(command=["make"],
                        haltOnFailure=True,
))
f_apr_9.addStep(Compile(command=["make" , "check"],
                        haltOnFailure=True,
))
# we dont need the install step, but whatever, lets test it anyway...
f_apr_9.addStep(Compile(command=["make" , "install"],
                        haltOnFailure=True,
))
f_apr_9.addStep(ShellCommand(
                command=["cp" , "/home/buildslave13/slave13/apr-trunk-fedora/build/build/bin/apr-2-config" , "/home/buildslave13/slave13/apr-trunk-fedora/"],
                description=["Copy apr-config"],
                descriptionDone=["apr-2-config copied"],
                haltOnFailure=True,
))

b_apr_9 = {'name': "apr-trunk-fedora",
      'slavename': "bb-fedora",
      'builddir': "apr-trunk-fedora",
      'factory': f_apr_9,
      'category': "apr-trunk-fedora",
      }

c['builders'].append(b_apr_9)

f_apr_10 = factory.BuildFactory()
f_apr_10.addStep(SVN(repourl=Interpolate("https://svn.apache.org/repos/asf/%(src::branch:~apr/apr/branches/1.4.x)s")))

f_apr_10.addStep(Compile(command=["./buildconf"],
                         haltOnFailure=True,
))
f_apr_10.addStep(Compile(command=["./configure" , "--prefix=/home/buildslave13/slave13/apr-branch-1.4-fedora/build/build"],
                         haltOnFailure=True,
))
f_apr_10.addStep(Compile(command=["make"],
                         haltOnFailure=True,
))
f_apr_10.addStep(Compile(command=["make" , "check"],
                         haltOnFailure=True,
))
f_apr_10.addStep(Compile(command=["make" , "install"],
                         haltOnFailure=True,
))
f_apr_10.addStep(ShellCommand(
                 command=["cp" , "/home/buildslave13/slave13/apr-branch-1.4-fedora/build/build/bin/apr-1-config" , "/home/buildslave13/slave13/apr-branch-1.4-fedora/"],
                 description=["Copy apr-1-config"],
                 descriptionDone=["apr-1-config copied"],
                 haltOnFailure=True,
))

b_apr_10 = {'name': "apr-branch-1.4-fedora",
       'slavename': "bb-fedora",
       'builddir': "apr-branch-1.4-fedora",
       'factory': f_apr_10,
       'category': "apr-branch-1.4-fedora",
       }

c['builders'].append(b_apr_10)

f_apr_11 = factory.BuildFactory()

f_apr_11.addStep(SVN(repourl=Interpolate("https://svn.apache.org/repos/asf/%(src::branch:~apr/apr-util/branches/1.3.x)s")))

f_apr_11.addStep(Compile(command=["./buildconf" , "--with-apr=/home/buildslave13/slave13/apr-branch-1.4-fedora/build/"],
                         haltOnFailure=True,
))
f_apr_11.addStep(Compile(command=["./configure" , "--prefix=/home/buildslave13/slave13/apr-util-branch-1.3-fedora/build/build" ,
                                 "--with-apr=/home/buildslave13/slave13/apr-branch-1.4-fedora/apr-1-config"],
                         haltOnFailure=True,
))
f_apr_11.addStep(Compile(command=["make"],
                         haltOnFailure=True,
))
f_apr_11.addStep(Compile(command=["make" , "check"],
                         haltOnFailure=True,
))

b_apr_11 = {'name': "apr-util-branch-1.3-fedora",
       'slavename': "bb-fedora",
       'builddir': "apr-util-branch-1.3-fedora",
       'factory': f_apr_11,
       'category': "apr-util-branch-1.3-fedora",
       }

c['builders'].append(b_apr_11)

f_apr_12 = factory.BuildFactory()

f_apr_12.addStep(SVN(repourl=Interpolate("https://svn.apache.org/repos/asf/%(src::branch:~apr/apr-util/branches/1.4.x)s")))

f_apr_12.addStep(Compile(command=["./buildconf" , "--with-apr=/home/buildslave13/slave13/apr-branch-1.4-fedora/build/"],
                         haltOnFailure=True,
))
f_apr_12.addStep(Compile(command=["./configure" , "--prefix=/home/buildslave13/slave13/apr-util-branch-1.4-fedora/build/build" , 
				 "--with-apr=/home/buildslave13/slave13/apr-branch-1.4-fedora/apr-1-config"],
		 	 haltOnFailure=True,
))
f_apr_12.addStep(Compile(command=["make"],
			 haltOnFailure=True,
))
f_apr_12.addStep(Compile(command=["make" , "check"],
 			 haltOnFailure=True,
))

b_apr_12 = {'name': "apr-util-branch-1.4-fedora",
       'slavename' : "bb-fedora",
       'builddir': "apr-util-branch-1.4-fedora",
       'factory': f_apr_12,
       'category': "apr-util-branch-1.4-fedora",
       }

c['builders'].append(b_apr_12)

#mail status

c['status'].append(mail.MailNotifier(fromaddr="buildbot@apache.org",
                                     extraRecipients=["dev@apr.apache.org"],
                                     sendToInterestedUsers=False,
                                     mode="change",
                                     categories=["apr-trunk" , "apr-branch-1.4" , "apr-util-branch-1.3" , "apr-util-branch-1.4",
                                                 "apr-trunk-fbsd" , "apr-branch-1.4-fbsd" , "apr-util-branch-1.3-fbsd" , "apr-util-branch-1.4-fbsd",
                                                 "apr-trunk-fedora" , "apr-branch-1.4-fedora" , "apr-util-branch-1.3-fedora" , "apr-util-branch-1.4-fedora"]))

c['status'].append(words.IRC(host="irc.freenode.net", nick="apr-bot",
                             allowForce=True,
                             channels=["#apr"],
			     notify_events={
			       'successToFailure': 1,
			       'failureToSuccess': 1,
			       },
                             categories=["apr-trunk" , "apr-branch-1.4" , "apr-util-branch-1.3" , "apr-util-branch-1.4",
                                         "apr-trunk-fbsd" , "apr-branch-1.4-fbsd" , "apr-util-branch-1.3-fbsd" , "apr-util-branch-1.4-fbsd",
                                         "apr-trunk-fedora" , "apr-branch-1.4-fedora" , "apr-util-branch-1.3-fedora" , "apr-util-branch-1.4-fedora"]))

