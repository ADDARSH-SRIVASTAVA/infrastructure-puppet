# This is the config filer for the Geronimo project.

# schedulers

#c['schedulers'].append(AnyBranchScheduler(name="on-geronimo-bundles-commit",
#                         branches=["geronimo/bundles/trunk"],
#                         treeStableTimer=2,
#                         builderNames=["geronimo-bundles-trunk"]))

#c['schedulers'].append(AnyBranchScheduler(name="on-geronimo-daytrader-commit",
#                         branches=["geronimo/daytrader/trunk"],
#                         treeStableTimer=2,
#                         builderNames=["geronimo-daytrader-trunk"]))

#c['schedulers'].append(AnyBranchScheduler(name="on-geronimo-devtools-eclipse-commit",
#                         branches=["geronimo/devtools/eclipse-plugin/trunk"],
#                         treeStableTimer=2,
#                         builderNames=["geronimo-devtools-eclipse-trunk"]))

#c['schedulers'].append(AnyBranchScheduler(name="on-geronimo-devtools-eclipse-30-commit",
#                         branches=["geronimo/devtools/eclipse-plugin/branches/3.0"],
#                         treeStableTimer=2,
#                         builderNames=["geronimo-devtools-eclipse-30"]))

#c['schedulers'].append(AnyBranchScheduler(name="on-geronimo-devtools-maven-commit",
#                         branches=["geronimo/devtools/maven-plugins/trunk"],
#                         treeStableTimer=2,
#                         builderNames=["geronimo-devtools-maven-trunk"]))

#c['schedulers'].append(AnyBranchScheduler(name="on-geronimo-genesis-commit",
#                         branches=["geronimo/genesis/trunk"],
#                         treeStableTimer=2,
#                         builderNames=["geronimo-genesis-trunk"]))

#c['schedulers'].append(AnyBranchScheduler(name="on-geronimo-gshell-commit",
#                         branches=["geronimo/gshell/trunk"],
#                         treeStableTimer=2,
#                         builderNames=["geronimo-gshell-trunk"]))

#c['schedulers'].append(AnyBranchScheduler(name="on-geronimo-samples-commit",
#                         branches=["geronimo/samples/trunk"],
#                         treeStableTimer=2,
#                         builderNames=["geronimo-samples-trunk"]))

#c['schedulers'].append(AnyBranchScheduler(name="on-geronimo-server-21-commit",
#                         branches=["geronimo/server/branches/2.1"],
#                         treeStableTimer=2,
#                         builderNames=["geronimo-server-21"]))
                         
#c['schedulers'].append(AnyBranchScheduler(name="on-geronimo-server-30-commit",
#                         branches=["geronimo/server/branches/3.0"],
#                         treeStableTimer=2,
#                         builderNames=["geronimo-server-30"]))
                         
#c['schedulers'].append(AnyBranchScheduler(name="on-geronimo-tomcat-7.0.27-commit",
#                         branches=["geronimo/external/trunk/tomcat-parent-7.0.27"],
#                         treeStableTimer=2,
#                         builderNames=["geronimo-tomcat-7.0.27"]))                         


#c['schedulers'].append(AnyBranchScheduler(name="on-geronimo-server-22-commit",
#                         branches=["geronimo/server/branches/2.2"],
#                         treeStableTimer=2,
#                         builderNames=["geronimo-server-22"]))

c['schedulers'].append(AnyBranchScheduler(name="on-geronimo-specs-commit",
                         branches=["geronimo/specs/trunk"],
                         treeStableTimer=2,
                         builderNames=["geronimo-specs-trunk"]))

#c['schedulers'].append(AnyBranchScheduler(name="on-geronimo-txmanager-commit",
#                         branches=["geronimo/components/txmanager/trunk"],
#                         treeStableTimer=2,
#                         builderNames=["geronimo-txmanager-trunk"]))

#c['schedulers'].append(AnyBranchScheduler(name="on-geronimo-txmanager-22-commit",
#                         branches=["geronimo/components/txmanager/branches/geronimo-txmanager-parent-2.2"],
#                         treeStableTimer=2,
#                         builderNames=["geronimo-txmanager-22"]))

c['schedulers'].append(AnyBranchScheduler(name="on-geronimo-xbean-commit",
                         branches=["geronimo/xbean/trunk"],
                         treeStableTimer=2,
                         builderNames=["geronimo-xbean-trunk"]))

#c['schedulers'].append(AnyBranchScheduler(name="on-geronimo-yoko-commit",
#                         branches=["geronimo/yoko/trunk"],
#                         treeStableTimer=2,
#                         builderNames=["geronimo-yoko-trunk"]))

# Below is a scheduler and its dependent children.

#gtrunk = AnyBranchScheduler(name="on-geronimo-server-commit",
#                          branches=["geronimo/server/trunk"],
#                          treeStableTimer=2,
#                          builderNames=["geronimo-server-trunk"])

#c['schedulers'].append(gtrunk)

#c['schedulers'].append(Dependent(name="geronimo-server-trunk-depend",
#                         upstream=gtrunk,
#                         builderNames=["geronimo-server-trunk-tomcat"]))
#                         builderNames=["geronimo-server-trunk-jetty" , "geronimo-server-trunk-tomcat"]))


c['schedulers'].append(Nightly(name='geronimo-site-production',
        builderNames=['geronimo-site-production'],
        branch='geronimo/site/trunk',
        hour=[0, 6, 12, 18],
        minute=49))

# NOTE : geronimo-trunk-deploy builder has no scheduler, insert one here
#        or it will never get triggered.
# NOTE : geronimo-trunk-deploy fails the configcheck due to no scheduler
#        and so it has been disabled.

#
# bundles
#


f66 = factory.BuildFactory()
f66.addStep(SVN(repourl=Interpolate("https://svn.apache.org/repos/asf/%(src::branch:~geronimo/bundles/trunk)s")))
f66.addStep(Compile(command=["mvn" , "-V" , "-U" , "clean" , "install" , "surefire-report:report-only" , "-Daggregate"],
                   env={'MAVEN_OPTS': '-Xmx1024m -XX:PermSize=64m -XX:MaxPermSize=1024m'},
                   warningPattern="(^WARN) | (^WARNING) | (^warning) | (.*warning[:].*)",
                   warnOnWarnings = False
))
f66.addStep(DirectoryUpload(slavesrc="target/site",
                            masterdest="/tmp/geronimo/bundles/site",
                            haltOnFailure=True,
))
f66.addStep(MasterShellCommand(command="""
            rm -rf /x1/buildmaster/master1/public_html/projects/geronimo/bundles/;
            cp -r /tmp/geronimo/bundles/site/ /x1/buildmaster/master1/public_html/projects/geronimo/bundles/"""
))
f66.addStep(Compile(command=["mvn" , "-V" , "-U" , "deploy" , "-DskipTests"],
                   env={'MAVEN_OPTS': '-Xmx1024m -XX:PermSize=64m -XX:MaxPermSize=1024m'},
                   warningPattern="(^WARN) | (^WARNING) | (^warning) | (.*warning[:].*)",
                   warnOnWarnings = False,
                   name = "deploy"
))


b66 = {'name': "geronimo-bundles-trunk",
      'slavename': "orcus_ubuntu",
      'builddir': "geronimo-bundles-trunk",
      'factory': f66,
      'category': "geronimo-bundles-trunk",
      }

#c['builders'].append(b66)

#
# daytrader
#

f67 = factory.BuildFactory()
f67.addStep(SVN(repourl=Interpolate("https://svn.apache.org/repos/asf/%(src::branch:~geronimo/daytrader/trunk)s")))
f67.addStep(Compile(command=["mvn" , "-V" , "-U" , "clean" , "install" , "surefire-report:report-only" , "-Daggregate"],
                   env={'MAVEN_OPTS': '-Xmx1024m -XX:PermSize=64m -XX:MaxPermSize=1024m'},
                   warningPattern="(^WARN) | (^WARNING) | (^warning) | (.*warning[:].*)",
                   warnOnWarnings = False
))
f67.addStep(DirectoryUpload(slavesrc="target/site",
                            masterdest="/tmp/geronimo/daytrader/site",
                            haltOnFailure=True,
))
f67.addStep(MasterShellCommand(command="""
            rm -rf /x1/buildmaster/master1/public_html/projects/geronimo/daytrader/;
            cp -r /tmp/geronimo/daytrader/site/ /x1/buildmaster/master1/public_html/projects/geronimo/daytrader/"""
))
f67.addStep(Compile(command=["mvn" , "-V" , "-U" , "deploy" , "-Dmaven.test.skip=true" , "-DfailIfNoTests=false"],
                   env={'MAVEN_OPTS': '-Xmx1024m -XX:PermSize=64m -XX:MaxPermSize=1024m'},
                   warningPattern="(^WARN) | (^WARNING) | (^warning) | (.*warning[:].*)",
                   warnOnWarnings = False,
                   name = "deploy"
))


b67 = {'name': "geronimo-daytrader-trunk",
      'slavename': "orcus_ubuntu",
      'builddir': "geronimo-daytrader-trunk",
      'factory': f67,
      'category': "geronimo-daytrader-trunk",
      }

#c['builders'].append(b67)

#
# devtools-eclipse
#

f68 = factory.BuildFactory()
f68.addStep(SVN(repourl=Interpolate("https://svn.apache.org/repos/asf/%(src::branch:~geronimo/devtools/eclipse-plugin/trunk)s")))
f68.addStep(Compile(command=["mvn" , "-V" , "-U" , "clean" , "install" , "surefire-report:report-only" , "-Daggregate"],
                   env={'MAVEN_OPTS': '-Xmx1024m -XX:PermSize=64m -XX:MaxPermSize=1024m'},
                   warningPattern="(^WARN) | (^WARNING) | (^warning) | (.*warning[:].*)",
                   warnOnWarnings = False
))
f68.addStep(DirectoryUpload(slavesrc="target/site",
                            masterdest="/tmp/geronimo/devtools-eclipse/site",
                            haltOnFailure=True,
))
f68.addStep(MasterShellCommand(command="""
            rm -rf /x1/buildmaster/master1/public_html/projects/geronimo/devtools-eclipse/;
            cp -r /tmp/geronimo/devtools-eclipse/site/ /x1/buildmaster/master1/public_html/projects/geronimo/devtools-eclipse/"""
))
f68.addStep(Compile(command=["mvn" , "-V" , "-U" , "clean" , "deploy" , "-Dmaven.test.skip=true" , "-DfailIfNoTests=false" , "-PbuildWithTimestamp"],
                   env={'MAVEN_OPTS': '-Xmx1024m -XX:PermSize=64m -XX:MaxPermSize=1024m'},
                   warningPattern="(^WARN) | (^WARNING) | (^warning) | (.*warning[:].*)",
                   warnOnWarnings = False,
                   name = "deploy"
))


b68 = {'name': "geronimo-devtools-eclipse-trunk",
      'slavename': "orcus_ubuntu",
      'builddir': "geronimo-devtools-eclipse-trunk",
      'factory': f68,
      'category': "geronimo-devtools-eclipse-trunk",
      }

#c['builders'].append(b68)


#
# devtools-eclipse-3.0
#

f168 = factory.BuildFactory()
f168.addStep(SVN(repourl=Interpolate("https://svn.apache.org/repos/asf/%(src::branch:~geronimo/devtools/eclipse-plugin/branches/3.0)s")))
f168.addStep(Compile(command=["mvn" , "-V" , "-U" , "clean" , "install" , "surefire-report:report-only" , "-Daggregate"],
                   env={'MAVEN_OPTS': '-Xmx1024m -XX:PermSize=64m -XX:MaxPermSize=1024m'},
                   warningPattern="(^WARN) | (^WARNING) | (^warning) | (.*warning[:].*)",
                   warnOnWarnings = False
))
f168.addStep(DirectoryUpload(slavesrc="target/site",
                            masterdest="/tmp/geronimo/devtools-eclipse-3.0/site",
                            haltOnFailure=True,
))
f168.addStep(MasterShellCommand(command="""
            rm -rf /x1/buildmaster/master1/public_html/projects/geronimo/devtools-eclipse-3.0/;
            cp -r /tmp/geronimo/devtools-eclipse-3.0/site/ /x1/buildmaster/master1/public_html/projects/geronimo/devtools-eclipse-3.0/"""
))
f168.addStep(Compile(command=["mvn" , "-V" , "-U" , "clean" , "deploy" , "-Dmaven.test.skip=true" , "-DfailIfNoTests=false" , "-PbuildWithTimestamp"],
                   env={'MAVEN_OPTS': '-Xmx1024m -XX:PermSize=64m -XX:MaxPermSize=1024m'},
                   warningPattern="(^WARN) | (^WARNING) | (^warning) | (.*warning[:].*)",
                   warnOnWarnings = False,
                   name = "deploy"
))


b168 = {'name': "geronimo-devtools-eclipse-30",
      'slavename': "orcus_ubuntu",
      'builddir': "geronimo-devtools-eclipse-30",
      'factory': f168,
      'category': "geronimo-devtools-eclipse-30",
      }

#c['builders'].append(b168)


#
# devtools-maven
#

f69 = factory.BuildFactory()
f69.addStep(SVN(repourl=Interpolate("https://svn.apache.org/repos/asf/%(src::branch:~geronimo/devtools/maven-plugins/trunk)s")))
f69.addStep(Compile(command=["mvn" , "-V" , "-U" , "clean" , "install" , "surefire-report:report-only" , "-Daggregate"],
                   env={'MAVEN_OPTS': '-Xmx1024m -XX:PermSize=64m -XX:MaxPermSize=1024m'},
                   warningPattern="(^WARN) | (^WARNING) | (^warning) | (.*warning[:].*)",
                   warnOnWarnings = False
))
f69.addStep(DirectoryUpload(slavesrc="target/site",
                            masterdest="/tmp/geronimo/devtools-maven/site",
                            haltOnFailure=True,
))
f69.addStep(MasterShellCommand(command="""
            rm -rf /x1/buildmaster/master1/public_html/projects/geronimo/devtools-maven/;
            cp -r /tmp/geronimo/devtools-maven/site/ /x1/buildmaster/master1/public_html/projects/geronimo/devtools-maven/"""
))
f69.addStep(Compile(command=["mvn" , "-V" , "-U" , "deploy" , "-Dmaven.test.skip=true" , "-DfailIfNoTests=false"],
                   env={'MAVEN_OPTS': '-Xmx1024m -XX:PermSize=64m -XX:MaxPermSize=1024m'},
                   warningPattern="(^WARN) | (^WARNING) | (^warning) | (.*warning[:].*)",
                   warnOnWarnings = False,
                   name = "deploy"
))


b69 = {'name': "geronimo-devtools-maven-trunk",
      'slavename': "orcus_ubuntu",
      'builddir': "geronimo-devtools-maven-trunk",
      'factory': f69,
      'category': "geronimo-devtools-maven-trunk",
      }

#c['builders'].append(b69)

#
# genesis
#

f70 = factory.BuildFactory()
f70.addStep(SVN(repourl=Interpolate("https://svn.apache.org/repos/asf/%(src::branch:~geronimo/genesis/trunk)s")))
f70.addStep(Compile(command=["mvn" , "-V" , "-U" , "clean" , "install" , "surefire-report:report-only" , "-Daggregate"],
                   env={'MAVEN_OPTS': '-Xmx1024m -XX:PermSize=64m -XX:MaxPermSize=1024m'},
                   warningPattern="(^WARN) | (^WARNING) | (^warning) | (.*warning[:].*)",
                   warnOnWarnings = False
))
f70.addStep(DirectoryUpload(slavesrc="target/site",
                            masterdest="/tmp/geronimo/genesis/site",
                            haltOnFailure=True,
))
f70.addStep(MasterShellCommand(command="""
            rm -rf /x1/buildmaster/master1/public_html/projects/geronimo/genesis/;
            cp -r /tmp/geronimo/genesis/site/ /x1/buildmaster/master1/public_html/projects/geronimo/genesis/"""
))
f70.addStep(Compile(command=["mvn" , "-V" , "-U" , "deploy" , "-Dmaven.test.skip=true" , "-DfailIfNoTests=false"],
                   env={'MAVEN_OPTS': '-Xmx1024m -XX:PermSize=64m -XX:MaxPermSize=1024m'},
                   warningPattern="(^WARN) | (^WARNING) | (^warning) | (.*warning[:].*)",
                   warnOnWarnings = False,
                   name = "deploy"
))


b70 = {'name': "geronimo-genesis-trunk",
      'slavename': "orcus_ubuntu",
      'builddir': "geronimo-genesis-trunk",
      'factory': f70,
      'category': "geronimo-genesis-trunk",
      'env':{'JAVA_HOME': '/home/buildslave1/slave1/tools/java/latest1.7'}
      }

#c['builders'].append(b70)



#
# gshell
#

f71 = factory.BuildFactory()
f71.addStep(SVN(repourl=Interpolate("https://svn.apache.org/repos/asf/%(src::branch:~geronimo/gshell/trunk)s")))
f71.addStep(Compile(command=["mvn" , "-V" , "-U" , "clean" , "install" , "surefire-report:report-only" , "-Daggregate"],
                   env={'MAVEN_OPTS': '-Xmx1024m -XX:PermSize=64m -XX:MaxPermSize=1024m'},
                   warningPattern="(^WARN) | (^WARNING) | (^warning) | (.*warning[:].*)",
                   warnOnWarnings = False
))
f71.addStep(DirectoryUpload(slavesrc="target/site",
                            masterdest="/tmp/geronimo/gshell/site",
                            haltOnFailure=True,
))
f71.addStep(MasterShellCommand(command="""
            rm -rf /x1/buildmaster/master1/public_html/projects/geronimo/gshell/;
            cp -r /tmp/geronimo/gshell/site/ /x1/buildmaster/master1/public_html/projects/geronimo/gshell/"""
))
f71.addStep(Compile(command=["mvn" , "-V" , "-U" , "deploy" , "-Dmaven.test.skip=true" , "-DfailIfNoTests=false"],
                   env={'MAVEN_OPTS': '-Xmx1024m -XX:PermSize=64m -XX:MaxPermSize=1024m'},
                   warningPattern="(^WARN) | (^WARNING) | (^warning) | (.*warning[:].*)",
                   warnOnWarnings = False,
                   name = "deploy"
))


b71 = {'name': "geronimo-gshell-trunk",
      'slavename': "orcus_ubuntu",
      'builddir': "geronimo-gshell-trunk",
      'factory': f71,
      'category': "geronimo-gshell-trunk",
      }

#c['builders'].append(b71)



#
# samples
#

f72 = factory.BuildFactory()
f72.addStep(SVN(repourl=Interpolate("https://svn.apache.org/repos/asf/%(src::branch:~geronimo/samples/trunk)s")))
f72.addStep(Compile(command=["mvn" , "-V" , "-U" , "clean" , "install" , "surefire-report:report-only" , "-Daggregate"],
                   env={'MAVEN_OPTS': '-Xmx1224m -XX:PermSize=64m -XX:MaxPermSize=1024m'},
                   warningPattern="(^WARN) | (^WARNING) | (^warning) | (.*warning[:].*)",
                   warnOnWarnings = False
))
f72.addStep(DirectoryUpload(slavesrc="target/site",
                            masterdest="/tmp/geronimo/samples/site",
                            haltOnFailure=True,
))
f72.addStep(MasterShellCommand(command="""
            rm -rf /x1/buildmaster/master1/public_html/projects/geronimo/samples/;
            cp -r /tmp/geronimo/samples/site/ /x1/buildmaster/master1/public_html/projects/geronimo/samples/"""
))
f72.addStep(Compile(command=["mvn" , "-V" , "-U" , "deploy" , "-Dmaven.test.skip=true" , "-DfailIfNoTests=false"],
                   env={'MAVEN_OPTS': '-Xmx1024m -XX:PermSize=64m -XX:MaxPermSize=1024m'},
                   warningPattern="(^WARN) | (^WARNING) | (^warning) | (.*warning[:].*)",
                   warnOnWarnings = False,
                   name = "deploy"
))


b72 = {'name': "geronimo-samples-trunk",
      'slavename': "orcus_ubuntu",
      'builddir': "geronimo-samples-trunk",
      'factory': f72,
      'category': "geronimo-samples-trunk",
      }

#c['builders'].append(b72)



#
# server
#

f73 = factory.BuildFactory()
f73.addStep(SVN(repourl=Interpolate("https://svn.apache.org/repos/asf/%(src::branch:~geronimo/server/trunk)s")))
f73.addStep(Compile(command=["mvn" , "-V" , "-X", "-U" , "clean" , "install" , "surefire-report:report-only" , "-Daggregate"],
                   env={'MAVEN_OPTS': '-Xmx1280m -XX:PermSize=64m -XX:MaxPermSize=1024m'},
                   warningPattern="(^WARN) | (^WARNING) | (^warning) | (.*warning[:].*)",
                   warnOnWarnings = False
))
f73.addStep(DirectoryUpload(slavesrc="target/site",
                            masterdest="/tmp/geronimo/server/site",
                            haltOnFailure=True,
))
f73.addStep(MasterShellCommand(command="""
            rm -rf /x1/buildmaster/master1/public_html/projects/geronimo/server/;
            cp -r /tmp/geronimo/server/site/ /x1/buildmaster/master1/public_html/projects/geronimo/server/"""
))
f73.addStep(Compile(command=["mvn" , "-V" , "-U" , "deploy" , "-Dmaven.test.skip=true" , "-DfailIfNoTests=false"],
                   env={'MAVEN_OPTS': '-Xmx1280m -XX:PermSize=64m -XX:MaxPermSize=1024m'},
                   warningPattern="(^WARN) | (^WARNING) | (^warning) | (.*warning[:].*)",
                   warnOnWarnings = False,
                   name = "deploy"
))

b73 = {'name': "geronimo-server-trunk",
      'slavename': "hemera_ubuntu",
      'builddir': "geronimo-server-trunk",
      'factory': f73,
      'category': "geronimo-server-trunk",
      }

#c['builders'].append(b73)

f73_tomcat = factory.BuildFactory()
f73_tomcat.addStep(SVN(repourl=Interpolate("https://svn.apache.org/repos/asf/%(src::branch:~geronimo/server/trunk)s")))
f73_tomcat.addStep(Compile(command=["mvn" , "-V" , "clean" , "install" , "-Pit" , "-DassemblyId=tomcat" ],
                    workdir="build/testsuite",
                    env={'MAVEN_OPTS': '-Xmx1280m -XX:PermSize=64m -XX:MaxPermSize=1024m'},
                    warningPattern="(^WARN) | (^WARNING) | (^warning) | (.*warning[:].*)",
                    warnOnWarnings = False,
                    name = "Testsuite:tomcat"
))

b73_tomcat = {'name': "geronimo-server-trunk-tomcat",
      'slavename': "hemera_ubuntu",
      'builddir': "geronimo-server-trunk-tomcat",
      'factory': f73_tomcat,
      'category': "geronimo-server-trunk-tomcat",
      }

# c['builders'].append(b73_tomcat)

f73_jetty = factory.BuildFactory()
f73_jetty.addStep(SVN(repourl=Interpolate("https://svn.apache.org/repos/asf/%(src::branch:~geronimo/server/trunk)s")))
f73_jetty.addStep(Compile(command=["mvn" , "-V" , "clean" , "install" , "-Pit" , "-DassemblyId=jetty" ],
                    workdir="build/testsuite",
                    env={'MAVEN_OPTS': '-Xmx1280m -XX:PermSize=64m -XX:MaxPermSize=1024m'},
                    warningPattern="(^WARN) | (^WARNING) | (^warning) | (.*warning[:].*)",
                    warnOnWarnings = False,
                    name = "Testsuite:jetty"
))

b73_jetty = {'name': "geronimo-server-trunk-jetty",
      'slavename': "hemera_ubuntu",
      'builddir': "geronimo-server-trunk-jetty",
      'factory': f73_jetty,
      'category': "geronimo-server-trunk-jetty",
      }

# c['builders'].append(b73_jetty)

#
# server
#

f84 = factory.BuildFactory()
f84.addStep(SVN(repourl=Interpolate("https://svn.apache.org/repos/asf/%(src::branch:~geronimo/server/branches/2.2)s")))
f84.addStep(Compile(command=["mvn" , "-V" , "-U" , "clean" , "install" , "surefire-report:report-only" , "-Daggregate"],
                   env={'MAVEN_OPTS': '-Xmx1280m -XX:PermSize=64m -XX:MaxPermSize=1024m'},
                   warningPattern="(^WARN) | (^WARNING) | (^warning) | (.*warning[:].*)",
                   warnOnWarnings = False
))
f84.addStep(DirectoryUpload(slavesrc="target/site",
                            masterdest="/tmp/geronimo/server22/site",
                            haltOnFailure=True,
))
f84.addStep(MasterShellCommand(command="""
            rm -rf /x1/buildmaster/master1/public_html/projects/geronimo/server22/;
            cp -r /tmp/geronimo/server22/site/ /x1/buildmaster/master1/public_html/projects/geronimo/server22/"""
))
f84.addStep(Compile(command=["mvn" , "-V" , "-U" , "deploy" , "-Dmaven.test.skip=true" , "-DfailIfNoTests=false"],
                   env={'MAVEN_OPTS': '-Xmx1280m -XX:PermSize=64m -XX:MaxPermSize=1024m'},
                   warningPattern="(^WARN) | (^WARNING) | (^warning) | (.*warning[:].*)",
                   warnOnWarnings = False,
                   name = "deploy"
))


b84 = {'name': "geronimo-server-22",
      'slavename': "orcus_ubuntu",
      'builddir': "geronimo-server-22",
      'factory': f84,
      'category': "geronimo-server-22",
      }

#c['builders'].append(b84)

#
# server
#

f85 = factory.BuildFactory()
f85.addStep(SVN(repourl=Interpolate("https://svn.apache.org/repos/asf/%(src::branch:~geronimo/server/branches/2.1)s")))
f85.addStep(Compile(command=["mvn" , "-V" , "-U" , "clean" , "install" , "surefire-report:report-only" , "-Daggregate"],
                   env={'MAVEN_OPTS': '-Xmx1280m -XX:PermSize=64m -XX:MaxPermSize=1024m'},
                   warningPattern="(^WARN) | (^WARNING) | (^warning) | (.*warning[:].*)",
                   warnOnWarnings = False
))
f85.addStep(DirectoryUpload(slavesrc="target/site",
                            masterdest="/tmp/geronimo/server21/site",
                            haltOnFailure=True,
))
f85.addStep(MasterShellCommand(command="""
            rm -rf /x1/buildmaster/master1/public_html/projects/geronimo/server21/;
            cp -r /tmp/geronimo/server21/site/ /x1/buildmaster/master1/public_html/projects/geronimo/server21/"""
))
f85.addStep(Compile(command=["mvn" , "-V" , "-U" , "deploy" , "-DskipTests", "-Pno-it" ],
                   env={'MAVEN_OPTS': '-Xmx1280m -XX:PermSize=64m -XX:MaxPermSize=1024m'},
                   warningPattern="(^WARN) | (^WARNING) | (^warning) | (.*warning[:].*)",
                   warnOnWarnings = False,
                   name = "deploy"
))


b85 = {'name': "geronimo-server-21",
      'slavename': "orcus_ubuntu",
      'builddir': "geronimo-server-21",
      'factory': f85,
      'category': "geronimo-server-21",
      'env':{'JAVA_HOME': '/home/buildslave1/slave1/tools/java/latest1.5'}
      }

#c['builders'].append(b85)

#
# server 3.0 branch
#

f87 = factory.BuildFactory()
f87.addStep(SVN(repourl=Interpolate("https://svn.apache.org/repos/asf/%(src::branch:~geronimo/server/branches/3.0)s")))
f87.addStep(Compile(command=["mvn" , "-V" , "-U" , "clean" , "install" , "surefire-report:report-only" , "-Daggregate"],
                   env={'MAVEN_OPTS': '-Xmx2048m -XX:PermSize=64m -XX:MaxPermSize=1024m -XX:ReservedCodeCacheSize=64m'},
                   warningPattern="(^WARN) | (^WARNING) | (^warning) | (.*warning[:].*)",
                   warnOnWarnings = False
))
f87.addStep(DirectoryUpload(slavesrc="target/site",
                            masterdest="/tmp/geronimo/server30/site",
                            haltOnFailure=True,
))
f87.addStep(MasterShellCommand(command="""
            rm -rf /x1/buildmaster/master1/public_html/projects/geronimo/server30/;
            cp -r /tmp/geronimo/server30/site/ /x1/buildmaster/master1/public_html/projects/geronimo/server30/"""
))
f87.addStep(Compile(command=["mvn" , "-V" , "-U" , "deploy" , "-DskipTests", "-Pno-it"],
                   env={'MAVEN_OPTS': '-Xmx2048m -XX:PermSize=64m -XX:MaxPermSize=1024m'},
                   warningPattern="(^WARN) | (^WARNING) | (^warning) | (.*warning[:].*)",
                   warnOnWarnings = False,
                   name = "deploy"
))


b87 = {'name': "geronimo-server-30",
      'slavename': "orcus_ubuntu",
      'builddir': "geronimo-server-30",
      'factory': f87,
      'category': "geronimo-server-30",
      'env':{'JAVA_HOME': '/usr/lib/jvm/java-6-sun'}
      }

#c['builders'].append(b87)

#
# external tomcat 7.0.27 stream
#

f88 = factory.BuildFactory()
f88.addStep(SVN(repourl=Interpolate("https://svn.apache.org/repos/asf/%(src::branch:~geronimo/external/trunk/tomcat-parent-7.0.27)s")))
f88.addStep(Compile(command=["mvn" , "-V" , "-U" , "clean" , "install" , "surefire-report:report-only" , "-Daggregate"],
                   env={'MAVEN_OPTS': '-Xmx1280m -XX:PermSize=64m -XX:MaxPermSize=1024m'},
                   warningPattern="(^WARN) | (^WARNING) | (^warning) | (.*warning[:].*)",
                   warnOnWarnings = False
))
f88.addStep(DirectoryUpload(slavesrc="target/site",
                            masterdest="/tmp/geronimo/external/trunk/tomcat-parent-7.0.27/site",
                            haltOnFailure=True,
))
f88.addStep(MasterShellCommand(command="""
            rm -rf /x1/buildmaster/master1/public_html/projects/geronimo/external/trunk/tomcat-parent-7.0.27/;
            mkdir -p /x1/buildmaster/master1/public_html/projects/geronimo/external/trunk/tomcat-parent-7.0.27;
            cp -r /tmp/geronimo/external/trunk/tomcat-parent-7.0.27/site/ /x1/buildmaster/master1/public_html/projects/geronimo/external/trunk/tomcat-parent-7.0.27/"""
))
f88.addStep(Compile(command=["mvn" , "-V" , "-U" , "deploy", "-DskipTests"],
                   env={'MAVEN_OPTS': '-Xmx1280m -XX:PermSize=64m -XX:MaxPermSize=1024m'},
                   warningPattern="(^WARN) | (^WARNING) | (^warning) | (.*warning[:].*)",
                   warnOnWarnings = False,
                   name = "deploy"
))


b88 = {'name': "geronimo-tomcat-7.0.27",
      'slavename': "orcus_ubuntu",
      'builddir': "geronimo-tomcat-7.0.27",
      'factory': f88,
      'category': "geronimo-tomcat-7.0.27",
      'env':{'JAVA_HOME': '/usr/lib/jvm/java-6-sun'}
      }

#c['builders'].append(b88)


#
# specs
#

f74 = factory.BuildFactory()
f74.addStep(SVN(repourl=Interpolate("https://svn.apache.org/repos/asf/%(src::branch:~geronimo/specs/trunk)s")))
f74.addStep(Compile(command=["mvn" , "-V" , "-U" , "clean" , "install" , "surefire-report:report-only" , "-Daggregate"],
                   env={'MAVEN_OPTS': '-Xmx1024m -XX:PermSize=64m -XX:MaxPermSize=1024m'},
                   warningPattern="(^WARN) | (^WARNING) | (^warning) | (.*warning[:].*)",
                   warnOnWarnings = False
))
f74.addStep(DirectoryUpload(slavesrc="target/site",
                            masterdest="/tmp/geronimo/specs/site",
                            haltOnFailure=True,
))
f74.addStep(MasterShellCommand(command="""
            rm -rf /x1/buildmaster/master1/public_html/projects/geronimo/specs/;
            cp -r /tmp/geronimo/specs/site/ /x1/buildmaster/master1/public_html/projects/geronimo/specs/"""
))
f74.addStep(Compile(command=["mvn" , "-V" , "-U" , "deploy" , "-Dmaven.test.skip=true" , "-DfailIfNoTests=false"],
                   env={'MAVEN_OPTS': '-Xmx1024m -XX:PermSize=64m -XX:MaxPermSize=1024m'},
                   warningPattern="(^WARN) | (^WARNING) | (^warning) | (.*warning[:].*)",
                   warnOnWarnings = False,
                   name = "deploy"
))


b74 = {'name': "geronimo-specs-trunk",
      'slavename': "orcus_ubuntu",
      'builddir': "geronimo-specs-trunk",
      'factory': f74,
      'category': "geronimo-specs-trunk",
      'env':{'JAVA_HOME': '/home/buildslave1/slave1/tools/java/latest1.7'}
      }

c['builders'].append(b74)

#
# txmanager
#

f75 = factory.BuildFactory()
f75.addStep(SVN(repourl=Interpolate("https://svn.apache.org/repos/asf/%(src::branch:~geronimo/components/txmanager/trunk)s")))
f75.addStep(Compile(command=["mvn" , "-V" , "-U" , "clean" , "install" , "surefire-report:report-only" , "-Daggregate"],
                   env={'MAVEN_OPTS': '-Xmx1024m -XX:PermSize=64m -XX:MaxPermSize=1024m'},
                   warningPattern="(^WARN) | (^WARNING) | (^warning) | (.*warning[:].*)",
                   warnOnWarnings = False
))
f75.addStep(DirectoryUpload(slavesrc="target/site",
                            masterdest="/tmp/geronimo/txmanager/site",
                            haltOnFailure=True,
))
f75.addStep(MasterShellCommand(command="""
            rm -rf /x1/buildmaster/master1/public_html/projects/geronimo/txmanager/;
            cp -r /tmp/geronimo/txmanager/site/ /x1/buildmaster/master1/public_html/projects/geronimo/txmanager/"""
))
f75.addStep(Compile(command=["mvn" , "-V" , "-U" , "deploy" , "-Dmaven.test.skip=true" , "-DfailIfNoTests=false"],
                   env={'MAVEN_OPTS': '-Xmx1024m -XX:PermSize=64m -XX:MaxPermSize=1024m'},
                   warningPattern="(^WARN) | (^WARNING) | (^warning) | (.*warning[:].*)",
                   warnOnWarnings = False,
                   name = "deploy"
))


b75 = {'name': "geronimo-txmanager-trunk",
      'slavename': "orcus_ubuntu",
      'builddir': "geronimo-txmanager-trunk",
      'factory': f75,
      'category': "geronimo-txmanager-trunk",
      }

#c['builders'].append(b75)

#
# txmanager
#

f86 = factory.BuildFactory()
f86.addStep(SVN(repourl=Interpolate("https://svn.apache.org/repos/asf/%(src::branch:~geronimo/components/txmanager/branches/geronimo-txmanager-parent-2.2)s")))
f86.addStep(Compile(command=["mvn" , "-V" , "-U" , "clean" , "install" , "surefire-report:report-only" , "-Daggregate"],
                   env={'MAVEN_OPTS': '-Xmx1024m -XX:PermSize=64m -XX:MaxPermSize=1024m'},
                   warningPattern="(^WARN) | (^WARNING) | (^warning) | (.*warning[:].*)",
                   warnOnWarnings = False
))
f86.addStep(DirectoryUpload(slavesrc="target/site",
                            masterdest="/tmp/geronimo/txmanager22/site",
                            haltOnFailure=True,
))
f86.addStep(MasterShellCommand(command="""
            rm -rf /x1/buildmaster/master1/public_html/projects/geronimo/txmanager22/;
            cp -r /tmp/geronimo/txmanager22/site/ /x1/buildmaster/master1/public_html/projects/geronimo/txmanager22/"""
))
f86.addStep(Compile(command=["mvn" , "-V" , "-U" , "deploy" , "-Dmaven.test.skip=true" , "-DfailIfNoTests=false"],
                   env={'MAVEN_OPTS': '-Xmx1024m -XX:PermSize=64m -XX:MaxPermSize=1024m'},
                   warningPattern="(^WARN) | (^WARNING) | (^warning) | (.*warning[:].*)",
                   warnOnWarnings = False,
                   name = "deploy"
))


b86 = {'name': "geronimo-txmanager-22",
      'slavename': "orcus_ubuntu",
      'builddir': "geronimo-txmanager-22",
      'factory': f86,
      'category': "geronimo-txmanager-22",
      }

#c['builders'].append(b86)


#
# xbean
#

f76 = factory.BuildFactory()
f76.addStep(SVN(repourl=Interpolate("https://svn.apache.org/repos/asf/%(src::branch:~geronimo/xbean/trunk)s")))
f76.addStep(Compile(command=["mvn" , "-V" , "-U" , "clean" , "install" , "surefire-report:report-only" , "-Daggregate"],
                   warningPattern="(^WARN) | (^WARNING) | (^warning) | (.*warning[:].*)",
                   warnOnWarnings = False
))
f76.addStep(DirectoryUpload(slavesrc="target/site",
                            masterdest="/tmp/geronimo/xbean/site",
                            haltOnFailure=True,
))
f76.addStep(MasterShellCommand(command="""
            rm -rf /x1/buildmaster/master1/public_html/projects/geronimo/xbean/;
            cp -r /tmp/geronimo/xbean/site/ /x1/buildmaster/master1/public_html/projects/geronimo/xbean/"""
))
f76.addStep(Compile(command=["mvn" , "-V" , "-U" , "deploy" , "-Dmaven.test.skip=true" , "-DfailIfNoTests=false"],
                   warningPattern="(^WARN) | (^WARNING) | (^warning) | (.*warning[:].*)",
                   warnOnWarnings = False,
                   name = "deploy"
))


b76 = {'name': "geronimo-xbean-trunk",
      'slavename': "hemera_ubuntu",
      'builddir': "geronimo-xbean-trunk",
      'factory': f76,
      'category': "geronimo-xbean-trunk",
      'env': {'MAVEN_OPTS': '-Xmx1024m -XX:PermSize=64m -XX:MaxPermSize=1024m',
	      'M2_HOME': '/home/buildslave18/slave18/tools/maven/latest3',
	      'M2': '/home/buildslave18/slave18/tools/maven/latest3/bin',
	      'JAVA_HOME': '/home/buildslave18/slave18/tools/java/latest1.7',
	      'PATH': '/home/buildslave18/slave18/tools/maven/latest3/bin:${PATH}'}
      }

c['builders'].append(b76)



#
# yoko
#

f77 = factory.BuildFactory()
f77.addStep(SVN(repourl=Interpolate("https://svn.apache.org/repos/asf/%(src::branch:~geronimo/yoko/trunk)s")))
f77.addStep(Compile(command=["mvn" , "-V" , "-U" , "clean" , "install" , "surefire-report:report-only" , "-Daggregate"],
                   env={'MAVEN_OPTS': '-Xmx1024m -XX:PermSize=64m -XX:MaxPermSize=1024m'},
                   warningPattern="(^WARN) | (^WARNING) | (^warning) | (.*warning[:].*)",
                   warnOnWarnings = False
))
f77.addStep(DirectoryUpload(slavesrc="target/site",
                            masterdest="/tmp/geronimo/yoko/site",
                            haltOnFailure=True,
))
f77.addStep(MasterShellCommand(command="""
            rm -rf /x1/buildmaster/master1/public_html/projects/geronimo/yoko/;
            cp -r /tmp/geronimo/yoko/site/ /x1/buildmaster/master1/public_html/projects/geronimo/yoko/"""
))
f77.addStep(Compile(command=["mvn" , "-V" , "-U" , "deploy" , "-Dmaven.test.skip=true" , "-DfailIfNoTests=false"],
                   env={'MAVEN_OPTS': '-Xmx1024m -XX:PermSize=64m -XX:MaxPermSize=1024m'},
                   warningPattern="(^WARN) | (^WARNING) | (^warning) | (.*warning[:].*)",
                   warnOnWarnings = False,
                   name = "deploy"
))


b77 = {'name': "geronimo-yoko-trunk",
      'slavename': "orcus_ubuntu",
      'builddir': "geronimo-yoko-trunk",
      'factory': f77,
      'category': "geronimo-yoko-trunk",
      }

#c['builders'].append(b77)

#
# Force server deploy
#

#f81 = factory.BuildFactory()
#f81.addStep(SVN(repourl=Interpolate("https://svn.apache.org/repos/asf/%(src::branch:~geronimo/server/trunk)s")))
#f81.addStep(Compile(command=["mvn" , "-V" , "-U" , "clean" , "deploy" , "-Dmaven.test.skip=true", "-DfailIfNoTests=false"],
#                   env={'MAVEN_OPTS': '-Xmx1280m -XX:PermSize=64m -XX:MaxPermSize=1024m'},
#                   warningPattern="(^WARN) | (^WARNING) | (^warning) | (.*warning[:].*)",
#                   warnOnWarnings = False,
#                   name = "deploy"
#))
#b81 = {'name': "geronimo-trunk-deploy",
#      'slavename': "orcus_ubuntu",
#      'builddir': "geronimo-trunk-deploy",
#      'factory': f81,
#      'category': "geronimo-trunk-deploy",
#      }

#c['builders'].append(b81)

f172 = factory.BuildFactory()
f172.addStep(Compile(command=["perl" , "/usr/local/cms/build/build_external.pl", "--type=shell", "--nonukes", "--noprops", "--source-base=/home/cmsslave/slave15/geronimo-site-production/build" , "--target-base=/usr/local/websites/production/geronimo/content"]))
f172.addStep(ShellCommand(command=["svn", "ci", "--username=buildbot", "/usr/local/websites/production/geronimo", "-m", "Production update by buildbot for geronimo"]))

b172 = {'name': "geronimo-site-production",
      'slavename': "bb-cms-slave",
      'builddir': "geronimo-site-production",
      'factory': f172,
      'category': "geronimo-site-production",
      }

c['builders'].append(b172)


c['status'].append(mail.MailNotifier(fromaddr="buildbot@apache.org",
                                      extraRecipients=["scm@geronimo.apache.org"],
                                      sendToInterestedUsers=False,
                                      mode="change",
                                      categories=["geronimo-specs-trunk" , "geronimo-xbean-trunk" , "geronimo-site-production"]))

c['status'].append(words.IRC(host="irc.freenode.net", nick="geronimobot",
                             allowForce=True,
                             channels=["#geronimo"],
			      notify_events={
				'successToFailure': 1,
				'failureToSuccess': 1,
				},
                             categories=["geronimo-specs-trunk" , "geronimo-xbean-trunk"]))

