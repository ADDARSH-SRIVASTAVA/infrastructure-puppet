# This is the config file for the wicket project.

# schedulers


c['schedulers'].append(SingleBranchScheduler(name="on-wicket-master-commit",
                    change_filter=filter.ChangeFilter(branch='master' , project='wicket'),
                    treeStableTimer=2,
                    builderNames=["wicket-master"]))

c['schedulers'].append(SingleBranchScheduler(name="on-wicket-branch-1.3.x-commit",
                    change_filter=filter.ChangeFilter(branch='wicket-1.3.x' , project='wicket'),
                    treeStableTimer=2,
                    builderNames=["wicket-branch-1.3.x"]))

c['schedulers'].append(SingleBranchScheduler(name="on-wicket-branch-1.4.x-commit",
                    change_filter=filter.ChangeFilter(branch='wicket-1.4.x' , project='wicket'),
                    treeStableTimer=2,
                    builderNames=["wicket-branch-1.4.x"]))

c['schedulers'].append(SingleBranchScheduler(name="on-wicket-branch-1.5.x-commit",
                    change_filter=filter.ChangeFilter(branch='wicket-1.5.x' , project='wicket'),
                    treeStableTimer=2,
                    builderNames=["wicket-branch-1.5.x"]))

c['schedulers'].append(SingleBranchScheduler(name="on-wicket-branch-6.x-commit",
                    change_filter=filter.ChangeFilter(branch='wicket-6.x' , project='wicket'),
                    treeStableTimer=2,
                    builderNames=["wicket-branch-6.x"]))
                         
#builders

f_wic_1 = factory.BuildFactory()
f_wic_1.addStep(Git(repourl="https://git-wip-us.apache.org/repos/asf/wicket.git", mode="full"))

f_wic_1.addStep(Compile(command=["mvn" , "javadoc:aggregate" , "-Djava.io.tmpdir=/tmp/buildbot"]
))

f_wic_1.addStep(DirectoryUpload(slavesrc="target/site/apidocs/",
                            masterdest="/tmp/wicket/apidocs/1.3.x/",
                            haltOnFailure=True,
))

# If we got this far, then uploading docs to tmp location on master was successful, 
# so now we can delete the previous published docs and move from tmp to published.

f_wic_1.addStep(MasterShellCommand(command="""
            rm -rf /x1/buildmaster/master1/public_html/projects/wicket/apidocs/1.3.x/;
            cp -r /tmp/wicket/apidocs/1.3.x /x1/buildmaster/master1/public_html/projects/wicket/apidocs/"""))

# Cleanup tmp

f_wic_1.addStep(MasterShellCommand(command="""
            rm -rf /tmp/wicket/apidocs/1.3.x""",
            alwaysRun=True,
))

# Always run the tmp cleanup step, in case of failures part way through uploading etc..

b_wic_1 = {'name': "wicket-branch-1.3.x",
      'slavename': "hemera_ubuntu",
      'builddir': "wicket-branch-1.3.x",
      'factory': f_wic_1,
      'category': "wicket-branch-1.3.x",
      'env':{'JAVA_HOME': '/home/buildslave18/slave18/tools/java/latest1.5'}
     }

c['builders'].append(b_wic_1)

f_wic_2 = factory.BuildFactory()
f_wic_2.addStep(Git(repourl="https://git-wip-us.apache.org/repos/asf/wicket.git", mode="full"))

 
f_wic_2.addStep(Compile(command=["mvn" , "javadoc:aggregate" , "-Djava.io.tmpdir=/tmp/buildbot"]
))

f_wic_2.addStep(DirectoryUpload(slavesrc="target/site/apidocs/",
                            masterdest="/tmp/wicket/apidocs/1.4.x/",
                            haltOnFailure=True,
))

# If we got this far, then uploading docs to tmp location on master was successful, 
# so now we can delete the previous published docs and move from tmp to published.

f_wic_2.addStep(MasterShellCommand(command="""
            rm -rf /x1/buildmaster/master1/public_html/projects/wicket/apidocs/1.4.x/;
            cp -r /tmp/wicket/apidocs/1.4.x /x1/buildmaster/master1/public_html/projects/wicket/apidocs/"""))

# Cleanup tmp

f_wic_2.addStep(MasterShellCommand(command="""
            rm -rf /tmp/wicket/apidocs/1.4.x""",
            alwaysRun=True,
))

# Always run the tmp cleanup step, in case of failures part way through uploading etc..

b_wic_2 = {'name': "wicket-branch-1.4.x",
      'slavename': "hemera_ubuntu",
      'builddir': "wicket-branch-1.4.x",
      'factory': f_wic_2,
      'category': "wicket-branch-1.4.x",
      'env':{'JAVA_HOME': '/home/buildslave18/slave18/tools/java/latest1.5'}
     }

c['builders'].append(b_wic_2)

f_wic_3 = factory.BuildFactory()
f_wic_3.addStep(Git(repourl="https://git-wip-us.apache.org/repos/asf/wicket.git", mode="full"))

 
f_wic_3.addStep(Compile(command=["mvn" , "javadoc:aggregate" , "-Djava.io.tmpdir=/tmp/buildbot"]
))

f_wic_3.addStep(DirectoryUpload(slavesrc="target/site/apidocs/",
                            masterdest="/tmp/wicket/apidocs/1.5.x/",
                            haltOnFailure=True,
))

# If we got this far, then uploading docs to tmp location on master was successful, 
# so now we can delete the previous published docs and move from tmp to published.

f_wic_3.addStep(MasterShellCommand(command="""
            rm -rf /x1/buildmaster/master1/public_html/projects/wicket/apidocs/1.5.x/;
            cp -r /tmp/wicket/apidocs/1.5.x /x1/buildmaster/master1/public_html/projects/wicket/apidocs/"""))

# Cleanup tmp

f_wic_3.addStep(MasterShellCommand(command="""
            rm -rf /tmp/wicket/apidocs/1.5.x""",
            alwaysRun=True,
))

# Always run the tmp cleanup step, in case of failures part way through uploading etc..

b_wic_3 = {'name': "wicket-branch-1.5.x",
      'slavename': "hemera_ubuntu",
      'builddir': "wicket-branch-1.5.x",
      'factory': f_wic_3,
      'category': "wicket-branch-1.5.x",
      'env':{'JAVA_HOME': '/home/buildslave18/slave18/tools/java/latest1.5'}
     }

c['builders'].append(b_wic_3)

# master

f_wic_4 = factory.BuildFactory()
f_wic_4.addStep(Git(repourl="https://git-wip-us.apache.org/repos/asf/wicket.git", mode="full"))

 
f_wic_4.addStep(Compile(command=["mvn" , "clean", "deploy", "-Pjs-test", "-Pguide", "javadoc:aggregate" , "-Djava.io.tmpdir=/tmp/buildbot"]
))

f_wic_4.addStep(DirectoryUpload(slavesrc="target/site/apidocs/",
                            masterdest="/tmp/wicket/apidocs/7.x/",
                            haltOnFailure=True,
))

f_wic_4.addStep(DirectoryUpload(slavesrc="wicket-user-guide/target/guide/7.x/",
                            masterdest="/tmp/wicket/guide/7.x/",
                            haltOnFailure=True,
))


# If we got this far, then uploading javadocs and guide to tmp location on master was successful, 
# so now we can delete the previous published docs and move from tmp to published.

f_wic_4.addStep(MasterShellCommand(command="""
            rm -rf /x1/buildmaster/master1/public_html/projects/wicket/guide/7.x/;
            mkdir -p /x1/buildmaster/master1/public_html/projects/wicket/guide/;
            cp -r /tmp/wicket/guide/7.x /x1/buildmaster/master1/public_html/projects/wicket/guide/7.x/"""))

f_wic_4.addStep(MasterShellCommand(command="""
            rm -rf /x1/buildmaster/master1/public_html/projects/wicket/apidocs/7.x/;
            mkdir -p /x1/buildmaster/master1/public_html/projects/wicket/apidocs/;
            cp -r /tmp/wicket/apidocs/7.x /x1/buildmaster/master1/public_html/projects/wicket/apidocs/"""))


# Cleanup tmp

f_wic_4.addStep(MasterShellCommand(command="""
            rm -rf /tmp/wicket/apidocs/7.x""",
            alwaysRun=True,
))

f_wic_4.addStep(MasterShellCommand(command="""
            rm -rf /tmp/wicket/guide/7.x""",
            alwaysRun=True,
))

# Always run the tmp cleanup step, in case of failures part way through uploading etc..

b_wic_4 = {'name': "wicket-master",
      'slavename': "hemera_ubuntu",
      'builddir': "wicket-master",
      'factory': f_wic_4,
      'category': "wicket-master",
      'env':{'JAVA_HOME': '/home/buildslave18/slave18/tools/java/latest1.7',
             'PATH': '/home/buildslave18/slave18/tools/maven/latest3/bin:/usr/lib/jvm/java-6-sun/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games',
             'MAVEN_OPTS': '-Xms256m -Xmx2048m -XX:MaxPermSize=256m'}
     }

c['builders'].append(b_wic_4)

# wicket-6.x

f_wic_5 = factory.BuildFactory()
f_wic_5.addStep(Git(repourl="https://git-wip-us.apache.org/repos/asf/wicket.git", mode="full"))

 
f_wic_5.addStep(Compile(command=["mvn3" , "clean", "deploy", "-Pjs-test", "-Pguide" , "javadoc:aggregate" , "-Djava.io.tmpdir=/tmp/buildbot"]
))

f_wic_5.addStep(DirectoryUpload(slavesrc="target/site/apidocs/",
                            masterdest="/tmp/wicket/apidocs/6.x/",
                            haltOnFailure=True,
))


f_wic_5.addStep(DirectoryUpload(slavesrc="wicket-user-guide/target/guide/6.x/",
                            masterdest="/tmp/wicket/guide/6.x/",
                            haltOnFailure=True,
))

# If we got this far, then uploading javadocs and guide to tmp location on wicket-6.x was successful, 
# so now we can delete the previous published docs and move from tmp to published.

f_wic_5.addStep(MasterShellCommand(command="""
            rm -rf /x1/buildmaster/master1/public_html/projects/wicket/guide/6.x/;
            mkdir -p /x1/buildmaster/master1/public_html/projects/wicket/guide/;
            cp -r /tmp/wicket/guide/6.x /x1/buildmaster/master1/public_html/projects/wicket/guide/6.x/"""))

f_wic_5.addStep(MasterShellCommand(command="""
            rm -rf /x1/buildmaster/master1/public_html/projects/wicket/apidocs/6.x/;
            mkdir -p /x1/buildmaster/master1/public_html/projects/wicket/apidocs/;
            cp -r /tmp/wicket/apidocs/6.x /x1/buildmaster/master1/public_html/projects/wicket/apidocs/"""))


# Cleanup tmp

f_wic_5.addStep(MasterShellCommand(command="""
            rm -rf /tmp/wicket/apidocs/6.x""",
            alwaysRun=True,
))

f_wic_5.addStep(MasterShellCommand(command="""
            rm -rf /tmp/wicket/guide/6.x""",
            alwaysRun=True,
))


# Always run the tmp cleanup step, in case of failures part way through uploading etc..

b_wic_5 = {'name': "wicket-branch-6.x",
      'slavename': "hemera_ubuntu",
      'builddir': "wicket-branch-6.x",
      'factory': f_wic_5,
      'category': "wicket-branch-6.x",
      'env':{'JAVA_HOME': '/home/buildslave18/slave18/tools/java/latest1.7',
             'MAVEN_OPTS': '-Xms256m -Xmx2048m -XX:MaxPermSize=256m'}
     }

c['builders'].append(b_wic_5)

#mail status

c['status'].append(mail.MailNotifier(fromaddr="buildbot@apache.org",
                                      extraRecipients=["commits@wicket.apache.org"],
                                      sendToInterestedUsers=False,
                                      mode="change",
                                      categories=["wicket-branch-1.3.x" , "wicket-branch-1.4.x" , "wicket-branch-1.5.x" , "wicket-branch-6.x" , "wicket-master"]))

c['status'].append(words.IRC(host="irc.freenode.net", nick="wicket-bot",
                              allowForce=True,
                              channels=["##wicket"],
			                        notify_events={
				                        'successToFailure': 1,
				                        'failureToSuccess': 1,
				                      },
                              categories=["wicket-branch-1.3.x" , "wicket-branch-1.4.x" , "wicket-branch-1.5.x" , "wicket-branch-6.x" , "wicket-master"]))

